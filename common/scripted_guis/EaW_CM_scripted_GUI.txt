scripted_gui = {
	EaW_Construction_Management = {
		window_name = "EaW_Construction_Management_window"
		parent_window_token = construction_tab
		context_type = player_context
		
		visible = {
			is_ai = no
		}
		
		triggers = {
			CM_infrastructure_construction_focus_icon_visible = { check_variable = { CM_construction_focus_ID = -1 } }
			
			CM_industrial_complexes_construction_focus_icon_visible = {
				OR = {
					check_variable = { CM_construction_focus_ID = 1 }
					check_variable = { CM_construction_focus_ID = 10 }
				}
			}
			
			CM_arms_factories_construction_focus_icon_visible = { check_variable = { CM_construction_focus_ID = 2 } }
			CM_naval_dockyards_construction_focus_icon_visible = { check_variable = { CM_construction_focus_ID = 3 } }
			
			CM_priority_filter_icon_visible = { has_country_flag = CM_priority_filter_on_flag }
			
			CM_targets_filter_button_right_click_enabled = {
				check_variable = {
					var = CM_targets_filter_regime
					compare = not_equals
					value = 2
				}
			}
		}
		
		properties = {
			CM_targets_filter_button = {
				frame = "CM_targets_filter_regime?1"
				x = "CM_targets_filter_regime_x_poz?-59"
			}
		}
		
		effects = {
			CM_build_infrastructure_button_click = {
				if = {
					limit = { CM_can_possible_build_infrastructure = yes }
					
					set_temp_variable = { CM_temp_num_of_available_civilian_factories_for_check = num_of_available_civilian_factories }
					
					if = {
						limit = { check_variable = { CM_infrastructure_construction_targets^num > 0 } }
						
						CM_check_infrastructure_construction_targets_for_targeted_infrastructure_level = yes
						
						if = {
							limit = { check_variable = { CM_infrastructure_construction_targets^num > 0 } }
							
							CM_check_infrastructure_construction_targets_for_ongoing_construction = yes
						}
					}
					
					CM_create_possible_infrastructure_targets_array = yes
					
					while_loop_effect = {
						limit = { always = yes } # do_while
						
						CM_add_infrastructure_construction = yes
						
						if = {
							limit = {
								OR = {
									check_variable = { CM_temp_num_of_available_civilian_factories_for_check > num_of_available_civilian_factories }
									CM_no_possible_construction_sites_for_infrastructure = yes
								}
							}
							
							set_temp_variable = { break = 1 }
						}
						else_if = {
							limit = { CM_possible_new_target_array_for_infrastructure = yes }
							
							CM_recreate_infrastructure_targets_array = yes
						}
					}
					
					print_variables = {
						file = CM_log_file
						text = CM_country_industrial_complexes_calculation_variables
						append = yes
					}
					
					CM_remove_infrastructure_construction_objects = yes
				}
			}
			CM_build_infrastructure_button_shift_click = {
				if = {
					limit = { CM_can_possible_build_infrastructure = yes }
					CM_add_multiple_infrastructure_constructions = yes
				}
			}
			CM_build_infrastructure_button_right_click = {
				if = {
					limit = {
						check_variable = {
							var = CM_construction_focus_ID
							compare = not_equals
							value = -1
						}
					}
					
					CM_update_infrastructure_construction_targets_array_on_set_construction_focus = yes
					
					if = {
						limit = { CM_can_possible_increase_resources = yes }
						
						if = {
							limit = { num_of_available_civilian_factories > 0 }
							
							CM_add_multiple_infrastructure_constructions = yes
						}
						
						set_variable = { CM_construction_focus_ID = -1 }
					}
				}
				else = {
					clear_variable = CM_construction_focus_ID
				}
			}
			
			CM_build_industrial_complexes_button_click = {
				if = {
					limit = { CM_can_possible_build_industrial_complex = yes }
					CM_calculate_objects_for_industrial_complex_construction = yes
					
					while_loop_effect = {
						limit = { always = yes } # do_while
						
						CM_add_industrial_complex_construction = yes
						CM_IC_num_of_available_civilian_factories_has_decreased = yes
					}
					
					CM_remove_possible_targeted_building_construction_targets_array = yes
				}
			}
			CM_build_industrial_complexes_button_control_click = {
				if = {
					limit = { CM_can_possible_build_industrial_complex = yes }
					CM_calculate_objects_for_industrial_complex_construction = yes
					
					while_loop_effect = {
						limit = { always = yes } # do_while
						
						CM_add_industrial_complexes_construction = yes
						CM_IC_num_of_available_civilian_factories_has_decreased = yes
					}
					
					CM_remove_possible_targeted_building_construction_targets_array = yes
				}
			}
			CM_build_industrial_complexes_button_shift_click = {
				if = {
					limit = { CM_can_possible_build_industrial_complex = yes }
					CM_add_multiple_industrial_complexes_constructions = yes
				}
			}
			CM_build_industrial_complexes_button_control_shift_click = {
				if = {
					limit = { CM_can_possible_build_industrial_complex = yes }
					CM_create_possible_industrial_complexes_targets_array = yes
					
					while_loop_effect = {
						limit = { always = yes } # do_while
						
						CM_add_industrial_complexes_construction = yes
						CM_IC_num_of_available_civilian_factories_is_zero = yes
					}
					
					CM_remove_possible_targeted_building_construction_targets_array = yes
				}
			}
			CM_build_industrial_complexes_button_right_click = {
				if = {
					limit = {
						check_variable = {
							var = CM_construction_focus_ID
							compare = not_equals
							value = 1
						}
					}
					
					if = {
						limit = {
							OR = {
								check_variable = { CM_construction_focus_ID = 10 }
								CM_any_defined_scopes_have_possible_free_industrial_complexes_slots = yes
							}
						}
						
						if = {
							limit = { num_of_available_civilian_factories > 0 }
							
							CM_add_multiple_industrial_complexes_constructions = yes
						}
						
						set_variable = { CM_construction_focus_ID = 1 }
					}
				}
				else = {
					clear_variable = CM_construction_focus_ID
				}
			}
			CM_build_industrial_complexes_button_alt_right_click = {
				if = {
					limit = {
						check_variable = {
							var = CM_construction_focus_ID
							compare = not_equals
							value = 10
						}
					}
					
					CM_update_infrastructure_construction_targets_array_on_set_construction_focus = yes
					
					if = {
						limit = {
							OR = {
								check_variable = { CM_construction_focus_ID = 1 }
								CM_any_defined_scopes_have_possible_free_industrial_complexes_slots = yes
							}
						}
						
						if = {
							limit = { num_of_available_civilian_factories > 0 }
							
							CM_add_multiple_industrial_complexes_and_infrastructure_constructions = yes
						}
						
						set_variable = { CM_construction_focus_ID = 10 }
					}
				}
				else = {
					clear_variable = CM_construction_focus_ID
				}
			}
			
			CM_build_arms_factories_button_click = {
				if = {
					limit = { CM_can_possible_build_arms_factory = yes }
					CM_calculate_objects_for_arms_factory_construction = yes
					
					while_loop_effect = {
						limit = { always = yes } # do_while
						
						CM_add_arms_factory_construction = yes
						CM_AF_num_of_available_civilian_factories_has_decreased = yes
					}
					
					CM_remove_possible_targeted_building_construction_targets_array = yes
				}
			}
			CM_build_arms_factories_button_control_click = {
				if = {
					limit = { CM_can_possible_build_arms_factory = yes }
					CM_calculate_objects_for_arms_factory_construction = yes
					
					while_loop_effect = {
						limit = { always = yes } # do_while
						
						CM_add_arms_factories_construction = yes
						CM_AF_num_of_available_civilian_factories_has_decreased = yes
					}
					
					CM_remove_possible_targeted_building_construction_targets_array = yes
				}
			}
			CM_build_arms_factories_button_shift_click = {
				if = {
					limit = { CM_can_possible_build_arms_factory = yes }
					CM_add_multiple_arms_factories_constructions = yes
				}
			}
			CM_build_arms_factories_button_control_shift_click = {
				if = {
					limit = { CM_can_possible_build_arms_factory = yes }
					CM_create_possible_arms_factory_targets_array = yes
					
					while_loop_effect = {
						limit = { always = yes } # do_while
						
						CM_add_arms_factories_construction = yes
						CM_AF_num_of_available_civilian_factories_is_zero = yes
					}
					
					CM_remove_possible_targeted_building_construction_targets_array = yes
				}
			}
			CM_build_arms_factories_button_right_click = {
				if = {
					limit = {
						check_variable = {
							var = CM_construction_focus_ID
							compare = not_equals
							value = 2
						}
					}
					
					if = {
						limit = { CM_any_defined_scopes_have_possible_free_arms_factories_slots = yes }
						
						if = {
							limit = { num_of_available_civilian_factories > 0 }
							
							CM_add_multiple_arms_factories_constructions = yes
						}
						
						set_variable = { CM_construction_focus_ID = 2 }
					}
				}
				else = {
					clear_variable = CM_construction_focus_ID
				}
			}
			CM_build_arms_factories_button_alt_right_click = {
				if = {
					limit = {
						check_variable = {
							var = CM_construction_focus_ID
							compare = not_equals
							value = 20
						}
					}
					
					CM_update_infrastructure_construction_targets_array_on_set_construction_focus = yes
					
					if = {
						limit = {
							OR = {
								check_variable = { CM_construction_focus_ID = 2 }
								CM_any_defined_scopes_have_possible_free_arms_factories_slots = yes
							}
						}
						
						if = {
							limit = { num_of_available_civilian_factories > 0 }
							
							CM_add_multiple_arms_factories_and_infrastructure_constructions = yes
						}
						
						set_variable = { CM_construction_focus_ID = 20 }
					}
				}
				else = {
					clear_variable = CM_construction_focus_ID
				}
			}
			
			CM_build_naval_dockyards_button_click = {
				if = {
					limit = { CM_can_possible_build_naval_dockyard = yes }
					CM_calculate_objects_for_naval_dockyard_construction = yes
					
					while_loop_effect = {
						limit = { always = yes } # do_while
						
						CM_add_naval_dockyard_construction = yes
						CM_ND_num_of_available_civilian_factories_has_decreased = yes
					}
					
					CM_remove_possible_targeted_building_construction_targets_array = yes
				}
			}
			CM_build_naval_dockyards_button_control_click = {
				if = {
					limit = { CM_can_possible_build_naval_dockyard = yes }
					CM_calculate_objects_for_naval_dockyard_construction = yes
					
					while_loop_effect = {
						limit = { always = yes } # do_while
						
						CM_add_naval_dockyards_construction = yes
						CM_ND_num_of_available_civilian_factories_has_decreased = yes
					}
					
					CM_remove_possible_targeted_building_construction_targets_array = yes
				}
			}
			CM_build_naval_dockyards_button_shift_click = {
				if = {
					limit = { CM_can_possible_build_naval_dockyard = yes }
					CM_add_multiple_naval_dockyards_constructions = yes
				}
			}
			CM_build_naval_dockyards_button_control_shift_click = {
				if = {
					limit = { CM_can_possible_build_naval_dockyard = yes }
					CM_create_possible_naval_dockyard_targets_array = yes
					
					while_loop_effect = {
						limit = { always = yes } # do_while
						
						CM_add_naval_dockyards_construction = yes
						CM_ND_num_of_available_civilian_factories_is_zero = yes
					}
					
					CM_remove_possible_targeted_building_construction_targets_array = yes
				}
			}
			CM_build_naval_dockyards_button_right_click = {
				if = {
					limit = {
						check_variable = {
							var = CM_construction_focus_ID
							compare = not_equals
							value = 3
						}
					}
					
					if = {
						limit = { CM_any_defined_scopes_have_possible_free_naval_dockyards_slots = yes }
						
						if = {
							limit = { num_of_available_civilian_factories > 0 }
							
							CM_add_multiple_naval_dockyards_constructions = yes
						}
						
						set_variable = { CM_construction_focus_ID = 3 }
					}
				}
				else = {
					clear_variable = CM_construction_focus_ID
				}
			}
			CM_build_naval_dockyards_button_alt_right_click = {
				if = {
					limit = {
						check_variable = {
							var = CM_construction_focus_ID
							compare = not_equals
							value = 30
						}
					}
					
					CM_update_infrastructure_construction_targets_array_on_set_construction_focus = yes
					
					if = {
						limit = {
							OR = {
								check_variable = { CM_construction_focus_ID = 2 }
								CM_any_defined_scopes_have_possible_free_naval_dockyards_slots = yes
							}
						}
						
						if = {
							limit = { num_of_available_civilian_factories > 0 }
							
							CM_add_multiple_naval_dockyards_and_infrastructure_constructions = yes
						}
						
						set_variable = { CM_construction_focus_ID = 30 }
					}
				}
				else = {
					clear_variable = CM_construction_focus_ID
				}
			}
			
			CM_ROI_button_click = {
				if = {
					limit = { has_variable = CM_ROI_coefficient }
					
					if = {
						limit = { check_variable = { CM_ROI_coefficient = 3 } }
						set_variable = { CM_ROI_coefficient = 1 }
					}
					else = {
						add_to_variable = { CM_ROI_coefficient = 1 }
					}
				}
				else = {
					set_variable = { CM_ROI_coefficient = 2 }
				}
			}
			
			CM_targets_filter_button_click = {
				if = {
					limit = { check_variable = { CM_targets_filter_regime?1 = 1 } }
					
					set_variable = { CM_targets_filter_regime = 3 }
					set_variable = { CM_targets_filter_regime_x_poz = -58 }
				}
				else = {
					subtract_from_variable = { CM_targets_filter_regime = 1 }
					subtract_from_variable = { CM_targets_filter_regime_x_poz = 1 }
					
					if = {
						limit = { check_variable = { CM_targets_filter_regime = 2 } }
						
						clr_country_flag = CM_priority_filter_on_flag
					}
				}
			}
			CM_targets_filter_button_right_click = {
				if = {
					limit = { has_country_flag = CM_priority_filter_on_flag }
					clr_country_flag = CM_priority_filter_on_flag
				}
				else = {
					set_country_flag = CM_priority_filter_on_flag
				}
			}
		}
		
		ai_enabled = {
			always = no
		}
	}
}
